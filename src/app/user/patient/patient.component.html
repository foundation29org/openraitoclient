<div class="mt-4 card card-block mx-auto" *ngIf="!loadedInfoPatient" style="max-width: 30rem !important;">
    <div class="card-body">
        <div class="row">
            <div class="col-lg-12 center-elements">
                <div>
                    <i class="fa fa-spinner fa-spin fa-fw"></i>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="" *ngIf="loadedInfoPatient">
    <div class="mx-auto card" style="max-width: 30rem !important;">
        <div class="" *ngIf="basicInfoPatient!=undefined"> <!--basicInfoPatient.group!=null"-->
            <div class="col-sm-12 content-header">
                <p class="mb-0">{{basicInfoPatient.patientName}} {{basicInfoPatient.surname}} </p>
                <p class="mb-0">{{basicInfoPatient.gender}}</p>
                <p class="mb-0">{{basicInfoPatient.birthDate | date }}</p>
                <p class="mb-0">{{basicInfoPatient.previousDiagnosis}}</p>
            </div>
        </div>
        <div *ngIf="!generalShare.data.medicalInfo">
            Si quieres solicitar nuevos permisos, picha aqu√≠!
        </div>
        <div class="row" *ngIf="generalShare.data.medicalInfo">
            <div class="col-sm-12 content-header">
                <span class="optionsCharts">
                    <span><button class="mb-0 btn btn-sm btn-secondary round mr-1" [disabled]="rangeDate=='month'"
                            (click)="loadDataRangeDate('month');">{{'charts.Last month' |
                            translate }}</button></span>
                    <span><button class="mb-0 btn btn-sm btn-secondary round mr-1" [disabled]="rangeDate=='quarter'"
                            (click)="loadDataRangeDate('quarter');">{{'charts.Last quarter' |
                            translate }}</button></span>
                    <span><button class="mb-0 btn btn-sm btn-secondary round mr-1" [disabled]="rangeDate=='year'"
                            (click)="loadDataRangeDate('year');">{{'charts.Last year' |
                            translate }}</button></span>
                </span>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12 ">
                <div *ngIf="!loadedInfoPatient">
                    <i class="fa fa-spinner fa-spin fa-fw"></i>
                </div>
                <div>
                    <div class="row" *ngIf="events.length > 0 && loadedEvents">
                        <div class="col-sm-12">
                            <div class="card mb-1 mt-1">
                                <div class="mb-2">
                                    <div class="card-block">
                                        <div class="row p-2">
                                            <div class="col-8">
                                                <h4 class="text-bold-500">{{'menu.Seizures' | translate }}
                                                    <em class="ft-info font-small-2" style="cursor: pointer;" placement="down" #p1="ngbPopover" [ngbPopover]="popContentseizures" popoverTitle="{{'charts.infoTitle' | translate }}"></em>
                                                    <ng-template #popContentseizures>
                                                        <span>
                                                            {{'charts.infoSeizures' | translate }}
                                                        </span>
                                                        <button class="pull-right mt-2" style="margin-top: 1em;margin-bottom: 1em;" (click)="p1.close()">Close</button>
                                                      </ng-template>
                                                </h4>
                                            </div>
                                            <div class="col-4">
                                                <a routerLink="/seizures" class="text-bold-500 float-right btn btn-primary btn-sm font-small-3 danger"
                                                title="{{'homeraito.p5' | translate }}">
                                                <span class="menu-title">+</span>
                                            </a>
                                            </div>
                                        </div>
                                        <div id="line-chart2" class="height-100">
                                            <ngx-charts-line-chart [scheme]="lineChartColorScheme"
                                                [results]="lineChartSeizures" [gradient]="barChartGradient"
                                                [xAxis]="false" [yAxis]="true" [yAxisTickFormatting]='axisFormat'
                                                [legend]="barChartShowLegend" [showXAxisLabel]="false"
                                                [showYAxisLabel]="false" [xAxisLabel]="barChartXAxisLabel"
                                                [yAxisLabel]="barChartYAxisLabel" [yAxisTicks]="yAxisTicksSeizures" (select)="onSelect($event)" >
                                                <ng-template #tooltipTemplate let-model="model">
                                                    <span>{{ model.name }}: {{ model.value }}</span>
                                                    <span class="d-block"
                                                        *ngFor="let type of model.types ; let i = index">
                                                        {{type.type}}: {{type.count}}
                                                    </span>
                                                </ng-template>
                                                <ng-template #seriesTooltipTemplate let-model="model">
                                                    <div *ngFor="let mod of model; let i = index">
                                                        <span class="d-block">{{ mod.name}}: {{ mod.value
                                                            }}</span>
                                                        <span class="d-block"
                                                            *ngFor="let type of mod.types ; let j = index">
                                                            {{type.type}}: {{type.count}}
                                                        </span>
                                                    </div>
                                                </ng-template>
                                            </ngx-charts-line-chart>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" *ngIf="events.length == 0 && loadedEvents">
                        <div class="col-sm-12">
                            <div class="card mb-1 mt-1">
                                <div class="">
                                    <div class="card-block">
                                        <div class="row p-2">
                                            <div class="col-10">
                                                <h4 class="text-bold-500 mb-0">{{'menu.Seizures' | translate }}
                                                    <em class="ft-info font-small-2" style="cursor: pointer;" placement="down" #p1="ngbPopover" [ngbPopover]="popContentseizures" popoverTitle="{{'charts.infoTitle' | translate }}"></em>
                                                    <ng-template #popContentseizures>
                                                        <span>
                                                            {{'charts.infoSeizures' | translate }}
                                                        </span>
                                                        <button class="pull-right mt-2" style="margin-top: 1em;margin-bottom: 1em;" (click)="p1.close()">Close</button>
                                                      </ng-template>
                                                </h4>
                                                <p class="mb-0">{{'charts.Noseizures' | translate }}
                                                    <span *ngIf="rangeDate!=''">
                                                        {{'charts.in the last' | translate }}
                                                        <span *ngIf="rangeDate=='month'">{{'charts.month' |
                                                            translate }}</span>
                                                        <span *ngIf="rangeDate=='quarter'">{{'charts.quarter' |
                                                            translate }}</span>
                                                        <span *ngIf="rangeDate=='year'">{{'charts.year' | translate
                                                            }}</span>
                                                    </span>
                                                </p>
                                            </div>
                                            <div class="col-2">
                                                <a routerLink="/seizures" class="text-bold-500 float-right btn btn-primary btn-sm font-small-3 danger"
                                                title="{{'homeraito.p5' | translate }}">
                                                <span class="menu-title">+</span>
                                            </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" *ngIf="feels.length > 0">
                        <div class="col-sm-12">
                            <div class="card mb-1 mt-1">
                                <div class="mb-2">
                                    <div class="card-block">
                                        <div class="row p-2">
                                            <div class="col-8">
                                                <h4 class="text-bold-500">{{'charts.Quality of life' | translate }}
                                                    <em class="ft-info font-small-2" style="cursor: pointer;" placement="down" #p1="ngbPopover" [ngbPopover]="popContentfeel" popoverTitle="{{'charts.infoTitle' | translate }}"></em>
                                                    <ng-template #popContentfeel>
                                                        <span>
                                                            {{'charts.infoFeel' | translate }}
                                                        </span>
                                                        <button class="pull-right mt-2" style="margin-top: 1em;margin-bottom: 1em;" (click)="p1.close()">Close</button>
                                                      </ng-template>
                                                </h4>
                                            </div>
                                            <div class="col-4">
                                                <a routerLink="/feel" class="text-bold-500 float-right btn btn-primary btn-sm font-small-3 danger"
                                                title="{{'charts.I want to answer how I feel today' | translate }}">
                                                <span class="menu-title">+</span>
                                            </a>
                                            </div>
                                        </div>
                                        <div id="line-chart2" class="height-100">
                                            <ngx-charts-bar-vertical-2d [scheme]="lineChartColorScheme"
                                                [results]="lineChartHeight" [gradient]="barChartGradient"
                                                [xAxis]="false" [yAxis]="true"
                                                [legend]="barChartShowLegend"
                                                [showXAxisLabel]="false"
                                                [xAxisTickFormatting]="tickFormatting"
                                                [showYAxisLabel]="false" [xAxisLabel]=""
                                                [autoScale]="false" [showText]="false" (select)="onSelect($event)"
                                                [yAxisTicks]=[0,5] [yScaleMax]="5"
                                                [yAxisTickFormatting]="axisFormat">
                                                <ng-template #tooltipTemplate let-model="model">
                                                    <span class="d-block">{{ model.name |date }}</span>
                                                    <span *ngIf="model.value==5">{{'charts.Very happy' | translate
                                                        }}</span>
                                                    <span *ngIf="model.value==4">{{'charts.Happy' | translate
                                                        }}</span>
                                                    <span *ngIf="model.value==3">Normal</span>
                                                    <span *ngIf="model.value==2">{{'charts.Sad' | translate
                                                        }}</span>
                                                    <span *ngIf="model.value==1">{{'charts.Very sad' | translate
                                                        }}</span>
                                                </ng-template>
                                                <ng-template #seriesTooltipTemplate let-model="model">
                                                    <div *ngFor="let mod of model; let i = index">
                                                        <span class="d-block">{{ mod.name |date }}</span>
                                                        <span *ngIf="mod.value==5">{{'charts.Very happy' | translate
                                                            }}</span>
                                                        <span *ngIf="mod.value==4">{{'charts.Happy' | translate
                                                            }}</span>
                                                        <span *ngIf="mod.value==3">Normal</span>
                                                        <span *ngIf="mod.value==2">{{'charts.Sad' | translate
                                                            }}</span>
                                                        <span *ngIf="mod.value==1">{{'charts.Very sad' | translate
                                                            }}</span>
                                                    </div>
                                                </ng-template>
                                            </ngx-charts-bar-vertical-2d>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" *ngIf="feels.length == 0 && loadedFeels">
                        <div class="col-sm-12">
                            <div class="card mb-1 mt-1">
                                <div class="">
                                    <div class="card-block">
                                        <div class="row p-2">
                                            <div class="col-10">
                                                <h4 class="text-bold-500 mb-0">{{'charts.Quality of life' |translate }}
                                                    <em class="ft-info font-small-2" style="cursor: pointer;" placement="down" #p1="ngbPopover" [ngbPopover]="popContentfeel" popoverTitle="{{'charts.infoTitle' | translate }}"></em>
                                                    <ng-template #popContentfeel>
                                                        <span>
                                                            {{'charts.infoFeel' | translate }}
                                                        </span>
                                                        <button class="pull-right mt-2" style="margin-top: 1em;margin-bottom: 1em;" (click)="p1.close()">Close</button>
                                                      </ng-template>
                                                </h4>
                                                <p class="mb-0">{{'charts.No data saved' | translate }}
                                                    <span
                                                    *ngIf="rangeDate!=''">{{'charts.in the last' | translate }} 
                                                    <span *ngIf="rangeDate=='month'">{{'charts.month' |
                                                        translate }}</span>
                                                    <span *ngIf="rangeDate=='quarter'">{{'charts.quarter' |
                                                        translate }}</span>
                                                    <span *ngIf="rangeDate=='year'">{{'charts.year' | translate
                                                        }}</span></span></p>
                                            </div>
                                            <div class="col-2">
                                                <a routerLink="/feel" class="text-bold-500 float-right btn btn-primary btn-sm font-small-3 danger"
                                                title="{{'charts.I want to answer how I feel today' | translate }}">
                                                <span class="menu-title">+</span>
                                            </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" *ngIf="medications.length > 0 && loadedDrugs">
                        <div class="col-sm-12">
                            <div class="card mb-1 mt-1" #ContainerRef>
                                <div class="mb-2">
                                    <div class="card-block pb-2">
                                        <div class="row p-2">
                                            <div class="col-8">
                                                <h4 class="text-bold-500 mb-0">{{'clinicalinfo.Medication' | translate }} 
                                                    <em class="ft-info font-small-2" style="cursor: pointer;" placement="down" #p1="ngbPopover" [ngbPopover]="popContentdrugs" popoverTitle="{{'charts.infoTitle' | translate }}"></em>
                                                    <ng-template #popContentdrugs>
                                                        <span>
                                                            {{'charts.infoDrugs' | translate }}
                                                        </span>
                                                        <button class="pull-right mt-2" style="margin-top: 1em;margin-bottom: 1em;" (click)="p1.close()">Close</button>
                                                      </ng-template>
                                                </h4>
                                                <span class="text-muted"> 
                                                    <label class="container pl-0">
                                                        <input type="checkbox" [(ngModel)]="normalized" (change)="normalizedChanged(normalized)">
                                                        <span class="checkmark"></span>
                                                      </label><span style="margin-left: 0.2rem !important;">{{titleDose}}</span>
                                                </span>
                                            </div>
                                            <div class="col-4">
                                                <a routerLink="/medication" class="text-bold-500 float-right btn btn-primary btn-sm font-small-3 danger"
                                                title="{{'homeraito.p7' | translate }}">
                                                <span class="menu-title">+</span>
                                            </a>
                                            </div>
                                        </div>
                                        
                                        <div id="line-chart2">
                                            <div id="chartdoseAvgDrugs" style="max-height: 100px;" class="ct-chart"
                                                height="200px"></div>
                                            <ngx-charts-line-chart [view]="[(ContainerRef.offsetWidth-30), 100]"
                                                [scheme]="lineChartColorScheme" [results]="lineChartDrugs"
                                                [gradient]="lineChartGradient" [xAxis]="false"
                                                [yAxis]="lineChartShowYAxis" [legend]="false"
                                                [legendPosition]="'below'"
                                                [showXAxisLabel]="lineChartShowXAxisLabel"
                                                [xAxisTickFormatting]="tickFormatting"
                                                [showYAxisLabel]="false" [xAxisLabel]="msgDate"
                                                [autoScale]="false" [xScaleMax]="today" [yAxisTicks]="yAxisTicksDrugs" (select)="onSelect($event)">
                                                <!--[timeline]="true"-->
                                            </ngx-charts-line-chart>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" *ngIf="medications.length == 0 && loadedDrugs">
                        <div class="col-sm-12">
                            <div class="card mb-1 mt-1">
                                <div class="">
                                    <div class="card-block">
                                        <div class="row p-2">
                                            <div class="col-10">
                                                <h4 class="text-bold-500 mb-0">{{'clinicalinfo.Medication' | translate }}
                                                    <em class="ft-info font-small-2" style="cursor: pointer;" placement="down" #p1="ngbPopover" [ngbPopover]="popContentdrugs" popoverTitle="{{'charts.infoTitle' | translate }}"></em>
                                                    <ng-template #popContentdrugs>
                                                        <span>
                                                            {{'charts.infoDrugs' | translate }}
                                                        </span>
                                                        <button class="pull-right mt-2" style="margin-top: 1em;margin-bottom: 1em;" (click)="p1.close()">Close</button>
                                                      </ng-template>
                                                </h4>
                                                <p class="mb-0">{{'charts.There is no drug data stored' | translate }} <span
                                                    *ngIf="rangeDate!=''">{{'charts.in the last' | translate }}
                                                    <span *ngIf="rangeDate=='month'">{{'charts.month' |
                                                        translate }}</span>
                                                    <span *ngIf="rangeDate=='quarter'">{{'charts.quarter' |
                                                        translate }}</span>
                                                    <span *ngIf="rangeDate=='year'">{{'charts.year' | translate
                                                        }}</span></span></p>
                                            </div>
                                            <div class="col-2">
                                                <a routerLink="/medication" class="text-bold-500 float-right btn btn-primary btn-sm font-small-3 danger"
                                                title="{{'homeraito.p7' | translate }}">
                                                <span class="menu-title">+</span>
                                            </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row"
                        *ngIf="medications.length > 0 && loadedDrugs && events.length > 0 && loadedEvents">
                        <div class="col-sm-12">
                            <div class="card mb-1 mt-1" #ContainerRef1>
                                <div class="mb-2">
                                    <div class="card-block pb-2">
                                        <div class="row p-2">
                                            <div class="col-12">
                                                <h4 class="text-bold-500 mb-0">{{'charts.Drugs vs Seizures' | translate }}</h4>
                                                <span class="text-muted">
                                                    <label class="container pl-0">
                                                        <input type="checkbox" [(ngModel)]="normalized2" (change)="normalizedChanged2(normalized2)">
                                                        <span class="checkmark"></span>
                                                      </label><span style="margin-left: 0.2rem !important;">{{titleDrugsVsDrugs}}</span> 
                                                </span>
                                            </div>
                                        </div>
                                        <div id="line-chart2">
                                            <div id="chartdoseAvgDrugs" style="max-height: 100px;" class="ct-chart"
                                                height="200px"></div>
                                                <combo-chart-component
                                                [view]="[(ContainerRef1.offsetWidth-90), 100]"
                                                [scheme]="comboBarScheme"
                                                [colorSchemeLine]="lineChartScheme"
                                                [results]="barChart"
                                                [animations]="animations"
                                                [lineChart]="lineChartSeries"
                                                [yAxisTickFormatting]="yLeftTickFormat"
                                                [yLeftAxisScaleFactor]="yLeftAxisScale"
                                                [yRightAxisScaleFactor]="yRightAxisScale"
                                                [yRightAxisTickFormatting]="yRightTickFormat"
                                                [gradient]="gradient"
                                                [xAxis]="showXAxis"
                                                [yAxis]="showYAxis"
                                                [legend]="showLegend"
                                                [legendTitle]="legendTitle"
                                                [legendPosition]="legendPosition"
                                                [showGridLines]="showGridLines"
                                                [showXAxisLabel]="showXAxisLabel"
                                                [showYAxisLabel]="showYAxisLabel"
                                                [showRightYAxisLabel]="showYAxisLabel"
                                                [xAxisLabel]="xAxisLabel"
                                                [yAxisLabel]="yAxisLabel"
                                                [yAxisLabelRight]="yAxisLabelRight">
                                                </combo-chart-component>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mx-auto" style="max-width: 30rem !important;">
        <div>
            
        </div>
    </div>

</div>